<% if local_assigns[:show_details] == true %>
  <div id="<%= dom_id bicycle %>">
    <div class="container mt-4">
      <div class="row">
        <div class="col-md-6">
          <% if @bicycle.image.attached? %>
            <%= image_tag @bicycle.image, class: "img-fluid rounded", alt: "Image de v√©lo" %>
          <% else %>
            <%= image_tag asset_path('icone_v√©lo.png'), class: "img-fluid rounded", alt: "Icone de v√©lo" %>
          <% end %>    
          <div class="d-flex justify-content-center mt-6">
            <p class="label p-2" style="border-radius: 25px; background-color: #FFDE8C;">
              <strong>Prix/heure : </strong>
              <%= bicycle.price_per_hour %> ‚Ç¨
            </p>
          </div>  
        </div>
        <div class="col-md-6">
          <h4 class="text-center">
            <%= bicycle.model %>
          </h4>
          <h6 class="text-center">
            <%= bicycle.city %>, <%= bicycle.country %>
          <h6>  
          <p>
            <%= bicycle.description %>
          </p> 
          <h5 class="text-center"> Caract√©ristiques</h5>
          <p>
           
          <ul>
            <p>
              <li>
                <strong>Cat√©gorie :</strong>
                <%= bicycle.bicycle_type.humanize %>
              </li>
            </p>
            <p>
              <li>
                <strong>Taille :</strong>
                <%= bicycle.size.humanize %>
              </li>
            </p>
            <p>
              <li>
                <strong>Etat :</strong>
                <%= bicycle.condition %>
              </li>
            </p>
            <p>
              <li>
              <strong>Accessoires :</strong>
              <% if bicycle.accessories.present? %>
                <%= bicycle.accessories.map(&:name).join(', ') %>
              <% else %>
                Pas d'accessoires disponibles.
              <% end %>
              </li>
            </p>
          </ul> 
          <p class="border rounded p-3 shadow mb-2 text-center">
          <span class="ml-2" role="img" aria-label="Avatar">üë§</span>
            <strong>Propri√©taire :</strong>
            <%= bicycle.owner.first_name %> <%= bicycle.owner.last_name %>
          </p>
          <div class="container mt-4">
            <div class="d-flex align-items-center mb-3">
              <h6 class="mx-3">Avis sur cet utilisateur</h6>
              <% received_reviews = Review.where(reviewed_user_id: @bicycle.owner_id) %>
              <% if received_reviews.count > 0 %>
                <% sum_of_ratings = received_reviews.sum(:rating) %>
                <% average_rating = sum_of_ratings.to_f / received_reviews.count %>
                <% average_rating_rounded = average_rating.round(1) %>
                <p class="label p-2 ml-2" style="border-radius: 25px; background-color: #FFDE8C;">
                  <strong><%= average_rating_rounded %>/5</strong>
                </p>
              <% else %>
              <% end %>
            </div>
            <div class="accordion" id="reviewsAccordion">
              <% if @bicycle.owner.owner_reviews.any? %>
                <% @bicycle.owner.owner_reviews.first(3).each_with_index do |owner_review, index| %>
                  <div class="accordion-item rounded shadow mb-3">
                    <h6 class="accordion-header" id="reviewHeading<%= index %>">
                      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#reviewCollapse<%= index %>" aria-expanded="true" aria-controls="reviewCollapse<%= index %>">
                        Note: <%= owner_review.rating %>/5
                        <i class="collapse-close fa fa-plus text-xs pt-1 position-absolute end-0 me-3" aria-hidden="true"></i>
                        <i class="collapse-open fa fa-minus text-xs pt-1 position-absolute end-0 me-3" aria-hidden="true"></i>
                      </button>
                    </h6>
                    <div id="reviewCollapse<%= index %>" class="accordion-collapse collapse" aria-labelledby="reviewHeading<%= index %>" data-bs-parent="#reviewsAccordion">
                      <div class="accordion-body">
                        Commentaire : <%= owner_review.review_text %>
                        <br></br>
                        Par : <%= owner_review.reviewer_user.first_name %> <%= owner_review.reviewer_user.last_name %>
                      </div>
                    </div>
                  </div>
                <% end %>
              <% else %>
                <p>L'utilisateur n'a pas encore d'avis</p>
              <% end %>  
            </div>
          </div>
        </div>
      </div>
    </div>   
    <p class="text-center">
      <strong>Adresse :</strong>
      <%= "#{bicycle.city},#{bicycle.postal_code}, #{bicycle.country}" %>
    </p>
  </div>
<% else %>
    
<div class="col mt-1">
  <div class="card card-blog card-plain">
    <div class="position-relative">
      <div class="d-block blur-shadow-image">
      <% if bicycle.image.attached? %>
        <%= image_tag bicycle.image, class: "img-fluid border-radius-lg" %>
      <% else %>
        <%= image_tag 'icone_v√©lo.png', class: "img-fluid border-radius-lg" %>
      <% end %>  
      </div>
    </div>
    <div class="card-body px-0 pt-1">
        <h5>
          <%= bicycle.model %>
        </h5>
      <p>
      Taille : <%= bicycle.size %> <br>
      </p>
      <p>
      Localisation : <%= bicycle.country %>, <%= bicycle.city %>
      </p>
    </div>
  </div>
  </div>	
<% end %>  